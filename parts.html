<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Two Little Bees ‚Äì Parts Inventory</title>
  <meta name="description" content="Two Little Bees Auto Parts ‚Äî yard parts inventory with pricing, warranty, and interchange info." />
  <meta name="color-scheme" content="dark">
  <meta name="theme-color" content="#0b0f14">

  <style>
    :root{
      --bg:#0b0f14;
      --panel:#111827;
      --panel-soft:#0f172a;
      --card:#0e1726;

      --text:#f9fafb;
      --muted:#9ca3af;

      --accent:#f4c430;
      --accent2:#ffb703;

      --border:rgba(255,255,255,.10);
      --border2:rgba(255,255,255,.14);

      --ok:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;

      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius: 16px;

      --max: 1100px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:
        radial-gradient(900px 450px at 15% 0%, rgba(244,196,48,.10), transparent 55%),
        radial-gradient(900px 500px at 90% 5%, rgba(255,183,3,.08), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.03), transparent 18%),
        var(--bg);
      color:var(--text);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      overflow-x:hidden;
    }

    a{ color:inherit; text-decoration:none; }
    button, input, select, textarea{ font:inherit; }

    .wrap{ max-width:var(--max); margin:0 auto; padding:18px; }

    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:12px 14px; border:1px solid var(--border); border-radius:var(--radius);
      background:rgba(17,24,39,.70); backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      position:sticky; top:10px; z-index:10;
    }

    .brand{
      display:flex; align-items:center; gap:12px; min-width:0;
    }
    .logo{
      width:42px; height:42px; border-radius:12px;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.18), transparent 60%),
        linear-gradient(135deg, rgba(244,196,48,.95), rgba(255,183,3,.75));
      border:1px solid rgba(0,0,0,.25);
      box-shadow: 0 10px 25px rgba(0,0,0,.35);
      flex:0 0 auto;
    }
    .title{
      display:flex; flex-direction:column; gap:2px; min-width:0;
    }
    .title b{
      font-size:14px; letter-spacing:.2px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .title span{
      font-size:12px; color:var(--muted);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    .navbtns{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end; }
    .btn{
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn:hover{ background: rgba(255,255,255,.06); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      border-color: rgba(244,196,48,.45);
      background: linear-gradient(180deg, rgba(244,196,48,.20), rgba(255,183,3,.10));
    }
    .pill{
      font-size:12px; color:var(--muted);
      padding:4px 10px; border:1px solid var(--border);
      border-radius:999px; background: rgba(0,0,0,.15);
    }

    .hero{
      margin-top:16px;
      border:1px solid var(--border);
      border-radius: calc(var(--radius) + 4px);
      background: linear-gradient(180deg, rgba(17,24,39,.75), rgba(15,23,42,.55));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hero-inner{ padding:18px; }
    .hero h1{
      margin:0 0 6px 0;
      font-size:20px;
      letter-spacing:.2px;
    }
    .hero p{
      margin:0;
      color:var(--muted);
      line-height:1.35;
      font-size:13px;
    }

    .controls{
      display:grid;
      grid-template-columns: 1.2fr .65fr .65fr .7fr auto;
      gap:10px;
      padding:14px 18px 18px 18px;
      border-top:1px solid var(--border);
      background: rgba(0,0,0,.10);
    }
    @media (max-width: 920px){
      .controls{ grid-template-columns: 1fr 1fr; }
      .controls .span2{ grid-column: span 2; }
      .controls .spanFull{ grid-column: 1 / -1; }
    }

    .field{
      display:flex; flex-direction:column; gap:6px;
    }
    .field label{ font-size:12px; color:var(--muted); }
    .field input, .field select{
      width:100%;
      background: rgba(0,0,0,.18);
      border: 1px solid var(--border);
      color: var(--text);
      padding:11px 12px;
      border-radius: 12px;
      outline:none;
    }
    .field input:focus, .field select:focus{
      border-color: rgba(244,196,48,.55);
      box-shadow: 0 0 0 3px rgba(244,196,48,.10);
    }

    .grid{
      margin-top:16px;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
    }

    .card{
      grid-column: span 12;
      border:1px solid var(--border);
      border-radius: var(--radius);
      background: rgba(17,24,39,.65);
      box-shadow: 0 14px 45px rgba(0,0,0,.35);
      overflow:hidden;
    }

    .list-head{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:14px 16px;
      border-bottom:1px solid var(--border);
      background: rgba(0,0,0,.14);
    }
    .list-head .left{
      display:flex; flex-direction:column; gap:2px; min-width:0;
    }
    .list-head .left b{ font-size:14px; }
    .list-head .left span{ font-size:12px; color:var(--muted); }

    .table{
      width:100%;
      border-collapse: collapse;
    }
    .table th, .table td{
      text-align:left;
      padding:12px 12px;
      border-bottom:1px solid rgba(255,255,255,.06);
      vertical-align: top;
      font-size:13px;
    }
    .table th{
      font-size:12px;
      color: var(--muted);
      background: rgba(0,0,0,.10);
      position: sticky;
      top: 82px;
      z-index: 5;
    }
    @media (max-width: 920px){
      .table th{ top: 126px; }
    }

    .badge{
      display:inline-flex; align-items:center; gap:6px;
      font-size:12px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      white-space:nowrap;
    }
    .dot{ width:8px; height:8px; border-radius:99px; background: var(--muted); }
    .dot.ok{ background: var(--ok); }
    .dot.warn{ background: var(--warn); }
    .dot.danger{ background: var(--danger); }

    .muted{ color:var(--muted); }
    .price{
      font-weight:800;
      letter-spacing:.2px;
    }

    .actions{
      display:flex; gap:8px; flex-wrap:wrap;
    }
    .mini{
      padding:8px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      cursor:pointer;
    }
    .mini:hover{ background: rgba(255,255,255,.06); }
    .mini.primary{
      border-color: rgba(244,196,48,.45);
      background: rgba(244,196,48,.12);
    }
    .mini.danger{
      border-color: rgba(239,68,68,.45);
      background: rgba(239,68,68,.10);
    }

    .empty{
      padding:18px;
      color:var(--muted);
      text-align:center;
    }

    /* Modal */
    .modal-backdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.60);
      display:none;
      align-items:center; justify-content:center;
      padding:16px;
      z-index: 50;
    }
    .modal{
      width:min(820px, 100%);
      border-radius: 18px;
      border:1px solid var(--border);
      background: rgba(17,24,39,.92);
      box-shadow: 0 30px 120px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .modal header{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:14px 16px;
      border-bottom:1px solid var(--border);
      background: rgba(0,0,0,.14);
    }
    .modal header b{ font-size:14px; }
    .modal header .x{
      width:38px; height:38px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      cursor:pointer;
      color:var(--text);
    }
    .modal header .x:hover{ background: rgba(255,255,255,.06); }

    .modal .body{ padding:14px 16px 16px 16px; }
    .form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .form .full{ grid-column: 1 / -1; }
    @media (max-width: 720px){
      .form{ grid-template-columns: 1fr; }
    }
    textarea{
      width:100%;
      min-height:84px;
      resize:vertical;
      background: rgba(0,0,0,.18);
      border: 1px solid var(--border);
      color: var(--text);
      padding:11px 12px;
      border-radius: 12px;
      outline:none;
    }
    textarea:focus{
      border-color: rgba(244,196,48,.55);
      box-shadow: 0 0 0 3px rgba(244,196,48,.10);
    }

    .modal .footer{
      display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;
      padding:12px 16px 16px 16px;
      border-top:1px solid var(--border);
      background: rgba(0,0,0,.10);
    }

    .toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background: rgba(0,0,0,.70);
      border:1px solid var(--border);
      color: var(--text);
      padding:10px 12px;
      border-radius: 14px;
      display:none;
      z-index: 99;
      max-width: min(720px, calc(100% - 24px));
      box-shadow: 0 20px 80px rgba(0,0,0,.55);
      font-size:13px;
    }

    .footer-note{
      margin: 14px 0 26px 0;
      color: var(--muted);
      font-size: 12px;
      text-align:center;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      font-size: 12px;
      padding:2px 6px;
      border:1px solid var(--border);
      border-bottom-color: rgba(0,0,0,.35);
      border-radius: 8px;
      background: rgba(0,0,0,.18);
      color: var(--text);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand" title="Two Little Bees Auto Parts">
        <div class="logo" aria-hidden="true"></div>
        <div class="title">
          <b>Two Little Bees ‚Äî Parts Inventory</b>
          <span>Warranty ‚Ä¢ Price ‚Ä¢ Interchanges ‚Ä¢ Yard info</span>
        </div>
      </div>

      <div class="navbtns">
        <a class="btn" href="index.html" title="Back to landing">‚¨ÖÔ∏è Landing</a>
        <a class="btn" href="https://twolittlebeesautoparts.github.io/" title="Back to car inventory">üöó Cars</a>
        <button class="btn primary" id="btnAdmin">üîí Admin</button>
        <span class="pill" id="countPill">0 parts</span>
      </div>
    </div>

    <section class="hero" aria-label="Parts Search">
      <div class="hero-inner">
        <h1>Find Parts Fast</h1>
        <p>Search by part name, vehicle, notes, stock ID, or interchange. Tap a part to call / ask about it.</p>
      </div>

      <div class="controls">
        <div class="field span2">
          <label for="q">Search</label>
          <input id="q" type="text" placeholder="Example: 5.7 Hemi, alternator, mirror, 2014 Silverado, LKQ, 560-..." autocomplete="off" />
        </div>

        <div class="field">
          <label for="cat">Category</label>
          <select id="cat">
            <option value="">All</option>
          </select>
        </div>

        <div class="field">
          <label for="cond">Condition</label>
          <select id="cond">
            <option value="">All</option>
            <option>Used</option>
            <option>New</option>
            <option>Reman</option>
            <option>Core</option>
          </select>
        </div>

        <div class="field">
          <label for="sort">Sort</label>
          <select id="sort">
            <option value="newest">Newest</option>
            <option value="priceAsc">Price (Low ‚Üí High)</option>
            <option value="priceDesc">Price (High ‚Üí Low)</option>
            <option value="nameAsc">Name (A ‚Üí Z)</option>
          </select>
        </div>

        <div class="field spanFull">
          <label>&nbsp;</label>
          <button class="btn" id="btnClear">üßπ Clear filters</button>
        </div>
      </div>
    </section>

    <div class="grid">
      <div class="card">
        <div class="list-head">
          <div class="left">
            <b>Available Parts</b>
            <span class="muted">Tip: press <span class="kbd">/</span> to jump to search.</span>
          </div>
          <div class="actions">
            <button class="mini" id="btnExport">‚¨áÔ∏è Export</button>
            <button class="mini" id="btnImport">‚¨ÜÔ∏è Import</button>
            <input id="importFile" type="file" accept="application/json" hidden />
          </div>
        </div>

        <div style="width:100%; overflow:auto;">
          <table class="table" id="partsTable">
            <thead>
              <tr>
                <th style="min-width:170px;">Part</th>
                <th style="min-width:120px;">Category</th>
                <th style="min-width:110px;">Condition</th>
                <th style="min-width:120px;">Price</th>
                <th style="min-width:200px;">Warranty</th>
                <th style="min-width:240px;">Interchange</th>
                <th style="min-width:170px;">Yard / Notes</th>
                <th style="min-width:190px;">Actions</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>

        <div class="empty" id="empty" style="display:none;">No parts match your search.</div>
      </div>
    </div>

    <div class="footer-note">
      Hablamos Espa√±ol ‚Ä¢ Call: <b>(317) 243-7777</b> ‚Ä¢ 507 S Tibbs Ave, Indianapolis
    </div>
  </div>

  <!-- ADMIN MODAL -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-label="Admin Panel">
    <div class="modal">
      <header>
        <b id="modalTitle">Admin</b>
        <button class="x" id="btnCloseModal" aria-label="Close">‚úï</button>
      </header>

      <div class="body">
        <div id="adminLogin">
          <div class="field">
            <label>Admin PIN</label>
            <input id="pin" type="password" inputmode="numeric" placeholder="Enter PIN" />
          </div>
          <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
            <button class="btn primary" id="btnUnlock">Unlock</button>
            <button class="btn" id="btnCancelUnlock">Cancel</button>
          </div>
          <p class="muted" style="margin:10px 0 0 0; font-size:12px;">
            Default PIN is <b>2222</b>. Change it in the code: <span class="kbd">ADMIN_PIN</span>.
          </p>
        </div>

        <div id="adminPanel" style="display:none;">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; margin-bottom:10px;">
            <span class="badge"><span class="dot ok"></span> Admin unlocked</span>
            <button class="mini" id="btnNew">‚ûï Add new part</button>
          </div>

          <form class="form" id="partForm" onsubmit="return false;">
            <div class="field">
              <label>Part Name *</label>
              <input id="f_name" placeholder="Ex: Engine 5.7 Hemi" />
            </div>

            <div class="field">
              <label>Category *</label>
              <input id="f_category" placeholder="Ex: Engine, Transmission, Body, Electrical..." />
            </div>

            <div class="field">
              <label>Condition</label>
              <select id="f_condition">
                <option>Used</option>
                <option>New</option>
                <option>Reman</option>
                <option>Core</option>
              </select>
            </div>

            <div class="field">
              <label>Price (USD) *</label>
              <input id="f_price" inputmode="decimal" placeholder="Ex: 799.99" />
            </div>

            <div class="field full">
              <label>Warranty</label>
              <input id="f_warranty" placeholder="Ex: 30-day start-up warranty ‚Ä¢ exchange only" />
            </div>

            <div class="field full">
              <label>Interchange</label>
              <input id="f_interchange" placeholder="Ex: Fits 2014‚Äì2019 Ram 1500 5.7 ‚Ä¢ P/N 1234AB ‚Ä¢ Hollander 300-12345" />
            </div>

            <div class="field">
              <label>Stock / Tag ID</label>
              <input id="f_stock" placeholder="Ex: BEE-01821" />
            </div>

            <div class="field">
              <label>Location</label>
              <input id="f_location" placeholder="Ex: Row 3 / Shelf B / Car #12" />
            </div>

            <div class="field full">
              <label>Notes</label>
              <textarea id="f_notes" placeholder="Ex: Tested good. Minor scratches. Include harness."></textarea>
            </div>
          </form>

          <div class="muted" style="font-size:12px; margin-top:10px;">
            * Required fields
          </div>
        </div>
      </div>

      <div class="footer" id="adminFooter" style="display:none;">
        <button class="btn" id="btnResetForm">Reset</button>
        <button class="btn danger" id="btnDelete" style="display:none;">Delete</button>
        <button class="btn primary" id="btnSave">Save</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    /**********************
     * CONFIG ‚Äî CHANGE THESE
     **********************/
    const SHOP_PHONE = "13172437777"; // dial-friendly: +1 + number, no dashes
    const SHOP_EMAIL = "twolittlebeesautoparts@gmail.com"; // change if you want
    const ADMIN_PIN = "2222"; // change this

    /**********************
     * STORAGE
     **********************/
    const LS_KEY = "tlb_parts_inventory_v1";

    /** @type {Array<PartItem>} */
    let parts = [];
    let adminUnlocked = false;
    let editingId = null;

    /**
     * @typedef {Object} PartItem
     * @property {string} id
     * @property {string} name
     * @property {string} category
     * @property {string} condition
     * @property {number} price
     * @property {string} warranty
     * @property {string} interchange
     * @property {string} stock
     * @property {string} location
     * @property {string} notes
     * @property {number} createdAt
     */

    const $ = (id) => document.getElementById(id);

    function uid(){
      return "p_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16);
    }

    function money(n){
      const v = Number(n);
      if (!isFinite(v)) return "‚Äî";
      return v.toLocaleString(undefined, { style:"currency", currency:"USD" });
    }

    function toast(msg){
      const t = $("toast");
      t.textContent = msg;
      t.style.display = "block";
      clearTimeout(toast._timer);
      toast._timer = setTimeout(() => t.style.display="none", 2600);
    }

    function loadParts(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(raw){
          const parsed = JSON.parse(raw);
          if(Array.isArray(parsed)) parts = parsed;
        } else {
          parts = seedParts(); // first run
          saveParts();
        }
      }catch(e){
        parts = seedParts();
        saveParts();
      }
    }

    function saveParts(){
      localStorage.setItem(LS_KEY, JSON.stringify(parts));
    }

    function seedParts(){
      const now = Date.now();
      return [
        {
          id: uid(),
          name: "Engine 5.7 Hemi (Complete)",
          category: "Engine",
          condition: "Used",
          price: 1499.00,
          warranty: "30-day start-up warranty ‚Ä¢ exchange only",
          interchange: "Fits multiple Ram/Charger/Challenger/300 5.7 (verify VIN) ‚Ä¢ Hollander 300-series",
          stock: "BEE-01021",
          location: "Row 2 ‚Ä¢ Pallet A",
          notes: "Compression checked. Includes intake. Accessories may vary.",
          createdAt: now - 1000*60*60*24*3
        },
        {
          id: uid(),
          name: "Transmission 6L80",
          category: "Transmission",
          condition: "Used",
          price: 899.00,
          warranty: "30-day warranty ‚Ä¢ exchange only",
          interchange: "GM 6L80 4x2/4x4 variants (verify tag) ‚Ä¢ Interchange varies by year",
          stock: "BEE-01089",
          location: "Shop ‚Ä¢ Rack 1",
          notes: "Pulled from running vehicle. Check bellhousing pattern.",
          createdAt: now - 1000*60*60*24*8
        },
        {
          id: uid(),
          name: "Alloy Wheel 18in (OEM)",
          category: "Wheels",
          condition: "Used",
          price: 125.00,
          warranty: "7-day check warranty",
          interchange: "18x8 6-lug (verify offset) ‚Ä¢ Multiple truck/SUV fitments",
          stock: "BEE-01211",
          location: "Wheel Wall ‚Ä¢ Slot 7",
          notes: "Minor rash. No bends found.",
          createdAt: now - 1000*60*60*24*1
        },
        {
          id: uid(),
          name: "Headlight (Right)",
          category: "Body / Lighting",
          condition: "Used",
          price: 160.00,
          warranty: "14-day warranty",
          interchange: "Verify by part number + housing tabs ‚Ä¢ Many trims differ",
          stock: "BEE-00977",
          location: "Shelf C ‚Ä¢ Bin 4",
          notes: "Lens clean. Tabs intact.",
          createdAt: now - 1000*60*60*24*12
        }
      ];
    }

    /**********************
     * FILTERING + RENDER
     **********************/
    function uniqueCategories(items){
      const set = new Set(items.map(p => (p.category || "").trim()).filter(Boolean));
      return Array.from(set).sort((a,b)=>a.localeCompare(b));
    }

    function renderCategoryOptions(){
      const catSel = $("cat");
      const current = catSel.value;
      catSel.innerHTML = '<option value="">All</option>';
      uniqueCategories(parts).forEach(c=>{
        const opt = document.createElement("option");
        opt.value = c; opt.textContent = c;
        catSel.appendChild(opt);
      });
      if([...catSel.options].some(o=>o.value===current)) catSel.value = current;
    }

    function getFiltered(){
      const q = ($("q").value || "").trim().toLowerCase();
      const cat = $("cat").value;
      const cond = $("cond").value;
      let out = parts.slice();

      if(cat) out = out.filter(p => p.category === cat);
      if(cond) out = out.filter(p => (p.condition || "") === cond);

      if(q){
        out = out.filter(p=>{
          const hay = [
            p.name, p.category, p.condition, p.warranty, p.interchange, p.stock, p.location, p.notes,
            String(p.price ?? "")
          ].join(" ").toLowerCase();
          return hay.includes(q);
        });
      }

      const sort = $("sort").value;
      if(sort === "priceAsc") out.sort((a,b)=>(a.price||0)-(b.price||0));
      if(sort === "priceDesc") out.sort((a,b)=>(b.price||0)-(a.price||0));
      if(sort === "nameAsc") out.sort((a,b)=> (a.name||"").localeCompare(b.name||""));
      if(sort === "newest") out.sort((a,b)=>(b.createdAt||0)-(a.createdAt||0));

      return out;
    }

    function condBadge(condition){
      const c = (condition || "Used").toLowerCase();
      let cls = "warn", label = condition || "Used";
      if(c === "new") cls = "ok";
      if(c === "used") cls = "warn";
      if(c === "reman") cls = "ok";
      if(c === "core") cls = "danger";
      return `<span class="badge"><span class="dot ${cls}"></span>${escapeHtml(label)}</span>`;
    }

    function escapeHtml(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function render(){
      const list = getFiltered();
      const tbody = $("tbody");
      tbody.innerHTML = "";

      $("countPill").textContent = `${list.length} part${list.length===1?"":"s"}`;
      $("empty").style.display = list.length ? "none" : "block";

      for(const p of list){
        const tr = document.createElement("tr");

        const askMsg = encodeURIComponent(
          `Hi! I‚Äôm interested in this part:\n\n`+
          `Part: ${p.name}\n`+
          `Category: ${p.category}\n`+
          `Condition: ${p.condition}\n`+
          `Price: ${money(p.price)}\n`+
          `Warranty: ${p.warranty}\n`+
          `Interchange: ${p.interchange}\n`+
          `Stock/Tag: ${p.stock}\n`+
          `Location: ${p.location}\n\n`+
          `Can you confirm availability and exact fitment?`
        );

        const emailLink = `mailto:${SHOP_EMAIL}?subject=${encodeURIComponent("Parts Inquiry ‚Äî Two Little Bees")}&body=${askMsg}`;
        const telLink = `tel:${SHOP_PHONE}`;

        tr.innerHTML = `
          <td>
            <div style="display:flex; flex-direction:column; gap:2px;">
              <b style="font-size:13px; letter-spacing:.2px;">${escapeHtml(p.name)}</b>
              <span class="muted" style="font-size:12px;">${escapeHtml(p.stock || "No tag")} ‚Ä¢ ${escapeHtml(p.location || "No location")}</span>
            </div>
          </td>
          <td>${escapeHtml(p.category || "‚Äî")}</td>
          <td>${condBadge(p.condition)}</td>
          <td><span class="price">${money(p.price)}</span></td>
          <td>${escapeHtml(p.warranty || "‚Äî")}</td>
          <td>${escapeHtml(p.interchange || "‚Äî")}</td>
          <td>${escapeHtml(p.notes || "‚Äî")}</td>
          <td>
            <div class="actions">
              <a class="mini primary" href="${telLink}" title="Call about this part">üìû Call</a>
              <a class="mini" href="${emailLink}" title="Email details">‚úâÔ∏è Email</a>
              <button class="mini" data-edit="${p.id}" title="Edit (admin)">‚úèÔ∏è Edit</button>
            </div>
          </td>
        `;

        tbody.appendChild(tr);
      }

      // wire edit buttons
      tbody.querySelectorAll("button[data-edit]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-edit");
          if(!adminUnlocked){
            openModal();
            toast("Admin locked ‚Äî enter PIN to edit.");
            return;
          }
          openEditor(id);
        });
      });
    }

    /**********************
     * ADMIN MODAL + CRUD
     **********************/
    function openModal(){
      $("modalBackdrop").style.display = "flex";
      $("pin").value = "";
      $("pin").focus();
      if(adminUnlocked){
        $("adminLogin").style.display = "none";
        $("adminPanel").style.display = "block";
        $("adminFooter").style.display = "flex";
      } else {
        $("adminLogin").style.display = "block";
        $("adminPanel").style.display = "none";
        $("adminFooter").style.display = "none";
      }
    }

    function closeModal(){
      $("modalBackdrop").style.display = "none";
    }

    function resetForm(){
      editingId = null;
      $("modalTitle").textContent = "Admin ‚Äî Add Part";
      $("f_name").value = "";
      $("f_category").value = "";
      $("f_condition").value = "Used";
      $("f_price").value = "";
      $("f_warranty").value = "";
      $("f_interchange").value = "";
      $("f_stock").value = "";
      $("f_location").value = "";
      $("f_notes").value = "";
      $("btnDelete").style.display = "none";
    }

    function openEditor(id){
      const p = parts.find(x=>x.id===id);
      if(!p){ toast("Part not found."); return; }
      openModal();
      $("adminLogin").style.display = "none";
      $("adminPanel").style.display = "block";
      $("adminFooter").style.display = "flex";

      editingId = id;
      $("modalTitle").textContent = "Admin ‚Äî Edit Part";
      $("f_name").value = p.name || "";
      $("f_category").value = p.category || "";
      $("f_condition").value = p.condition || "Used";
      $("f_price").value = String(p.price ?? "");
      $("f_warranty").value = p.warranty || "";
      $("f_interchange").value = p.interchange || "";
      $("f_stock").value = p.stock || "";
      $("f_location").value = p.location || "";
      $("f_notes").value = p.notes || "";
      $("btnDelete").style.display = "inline-flex";
    }

    function validateForm(){
      const name = $("f_name").value.trim();
      const category = $("f_category").value.trim();
      const price = Number(($("f_price").value || "").trim());
      if(!name) return { ok:false, msg:"Part Name is required." };
      if(!category) return { ok:false, msg:"Category is required." };
      if(!isFinite(price) || price < 0) return { ok:false, msg:"Price must be a valid number." };
      return { ok:true, price, name, category };
    }

    function saveFromForm(){
      const v = validateForm();
      if(!v.ok){ toast(v.msg); return; }

      const payload = {
        name: $("f_name").value.trim(),
        category: $("f_category").value.trim(),
        condition: $("f_condition").value,
        price: v.price,
        warranty: $("f_warranty").value.trim(),
        interchange: $("f_interchange").value.trim(),
        stock: $("f_stock").value.trim(),
        location: $("f_location").value.trim(),
        notes: $("f_notes").value.trim(),
      };

      if(editingId){
        const idx = parts.findIndex(x=>x.id===editingId);
        if(idx === -1){ toast("Part not found."); return; }
        parts[idx] = { ...parts[idx], ...payload };
        toast("Saved changes.");
      } else {
        parts.unshift({
          id: uid(),
          createdAt: Date.now(),
          ...payload
        });
        toast("Part added.");
      }

      saveParts();
      renderCategoryOptions();
      render();
      closeModal();
    }

    function deleteEditing(){
      if(!editingId) return;
      const p = parts.find(x=>x.id===editingId);
      if(!p) return;
      const yes = confirm(`Delete "${p.name}"?`);
      if(!yes) return;
      parts = parts.filter(x=>x.id!==editingId);
      saveParts();
      renderCategoryOptions();
      render();
      toast("Part deleted.");
      closeModal();
    }

    /**********************
     * IMPORT / EXPORT
     **********************/
    function exportJson(){
      const blob = new Blob([JSON.stringify(parts, null, 2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "two-little-bees-parts.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      toast("Export downloaded.");
    }

    function importJsonFile(file){
      const reader = new FileReader();
      reader.onload = () => {
        try{
          const parsed = JSON.parse(reader.result);
          if(!Array.isArray(parsed)) throw new Error("Invalid format");
          // basic sanitize
          const cleaned = parsed.map(p => ({
            id: String(p.id || uid()),
            name: String(p.name || "").trim(),
            category: String(p.category || "").trim(),
            condition: String(p.condition || "Used"),
            price: Number(p.price || 0),
            warranty: String(p.warranty || ""),
            interchange: String(p.interchange || ""),
            stock: String(p.stock || ""),
            location: String(p.location || ""),
            notes: String(p.notes || ""),
            createdAt: Number(p.createdAt || Date.now()),
          })).filter(p => p.name && p.category);

          parts = cleaned;
          saveParts();
          renderCategoryOptions();
          render();
          toast("Import complete.");
        }catch(e){
          toast("Import failed. Make sure it's a valid JSON export.");
        }
      };
      reader.readAsText(file);
    }

    /**********************
     * EVENTS
     **********************/
    function wire(){
      // Keyboard shortcut: "/" focuses search
      window.addEventListener("keydown", (e)=>{
        if(e.key === "/" && document.activeElement && !["INPUT","TEXTAREA","SELECT"].includes(document.activeElement.tagName)){
          e.preventDefault();
          $("q").focus();
        }
        if(e.key === "Escape" && $("modalBackdrop").style.display === "flex"){
          closeModal();
        }
      });

      $("q").addEventListener("input", render);
      $("cat").addEventListener("change", render);
      $("cond").addEventListener("change", render);
      $("sort").addEventListener("change", render);

      $("btnClear").addEventListener("click", ()=>{
        $("q").value = "";
        $("cat").value = "";
        $("cond").value = "";
        $("sort").value = "newest";
        render();
      });

      $("btnAdmin").addEventListener("click", openModal);
      $("btnCloseModal").addEventListener("click", closeModal);

      $("modalBackdrop").addEventListener("click", (e)=>{
        if(e.target === $("modalBackdrop")) closeModal();
      });

      $("btnCancelUnlock").addEventListener("click", closeModal);

      $("btnUnlock").addEventListener("click", ()=>{
        const pin = $("pin").value.trim();
        if(pin === ADMIN_PIN){
          adminUnlocked = true;
          toast("Admin unlocked.");
          openModal();
          resetForm();
        } else {
          toast("Wrong PIN.");
        }
      });

      $("btnNew").addEventListener("click", ()=>{
        resetForm();
        $("f_name").focus();
      });

      $("btnSave").addEventListener("click", saveFromForm);
      $("btnResetForm").addEventListener("click", resetForm);
      $("btnDelete").addEventListener("click", deleteEditing);

      $("btnExport").addEventListener("click", exportJson);
      $("btnImport").addEventListener("click", ()=> $("importFile").click());
      $("importFile").addEventListener("change", (e)=>{
        const f = e.target.files && e.target.files[0];
        if(f) importJsonFile(f);
        e.target.value = "";
      });
    }

    /**********************
     * INIT
     **********************/
    loadParts();
    renderCategoryOptions();
    wire();
    render();

    // If you want admin to re-lock each refresh, keep as-is.
    // If you want admin to stay unlocked, you can store adminUnlocked in localStorage.
  </script>
</body>
</html>
